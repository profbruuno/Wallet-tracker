<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TikStake Memeboard</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <header class="header">
      <div>
        <h1>TikStake Memeboard</h1>
        <div class="status" id="connectionStatus">
          <span class="status-dot online"></span>
          <span id="statusText">Connected</span>
        </div>
      </div>
      <div style="display: flex; gap: 10px; align-items: center;">
        <button id="refreshBtn" class="refresh-btn">
          Refresh
        </button>
        <button id="tradeBtn" class="trade-btn">
          Trade
        </button>
        <button id="portfolioBtn" class="portfolio-btn">
          Portfolio Tracker
        </button>
        <button id="themeToggle" class="theme-toggle">
          Dark Mode
        </button>
      </div>
    </header>

    <p class="muted">
      Auto-refreshes every 2 minutes  • Last updated: <span id="lastUpdated">-</span>
    </p>

    <!-- Trade Modal -->
    <div id="tradeModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div class="modal-header">
          <h2>Trade Solana Memecoins</h2>
        </div>
        <div class="modal-body">
          <p>Maximize your trading potential with these benefits:</p>
          <ul>
            <li>Low transaction fees on Solana network</li>
            <li>Fast transaction processing</li>
            <li>High potential returns</li>
            <li>Diverse token selection</li>
            <li>Innovative trading tools</li>
            <li>Global community of traders</li>
            <li>Real-time market data</li>
            <li>Mobile trading compatibility</li>
            <li>Low barrier to entry</li>
          </ul>
          
          <div class="referral-section">
            <h3>Enhanced Trading with Trojan Bot</h3>
            <p>Use our referral link to access powerful trading tools on Telegram:</p>
            <a href="https://t.me/solana_trojanbot?start=r-profbrunoo" target="_blank" class="referral-link">
              https://t.me/solana_trojanbot?start=r-profbrunoo
            </a>
            <p class="bonus-note">Your friends save 10% with your link!</p>
            
            <h4>Trojan Bot Features:</h4>
            <ul>
              <li>Key Features of the Trojan Bot</li>
              <li>Non-Custodial Wallet Integration</li>
              <li>Lightning-Fast Trades</li> 
              <li>Anti-MEV Protection</li>
              <li>Automated Sniping</li>
              <li>Advanced Order Types</li>
              <li>Limit Orders</li>
              <li>DCA (Dollar-Cost Averaging) Orders</li>
              <li>Copy Trading</li>
              <li>Real-Time Monitoring & Alerts</li>
              <li>High Security</li> 
              <li>Intelligent Routing</li>
              <li>Bridge & Withdrawal Functionality</li>
              <li>Real-time token alerts</li>
              <li>Automated trading strategies</li>
              <li>Portfolio tracking</li>
              <li>Customizable notifications</li>
            </ul>
          </div>
          
          <div class="referral-section">
            <h3>Getting Started with Solana Memecoins</h3>
            <p>New to trading Solana memecoins? Follow these steps:</p>
            <ol>
              <li>Set up a Solana wallet (Phantom, Solflare, or Backpack)</li>
              <li>Fund your wallet with SOL from an exchange</li>
              <li>Use decentralized exchanges like Raydium or Orca</li>
              <li>Research tokens before investing</li>
              <li>Start with small investments</li>
              <li>Use stop-losses to manage risk</li>
              <li>Join community channels for insights</li>
            </ol>
            
            <p>Remember: Memecoin trading involves significant risk. Only invest what you can afford to lose, and always do your own research.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Portfolio Tracker Modal -->
    <div id="portfolioModal" class="modal">
      <div class="modal-content portfolio-modal">
        <span class="close">&times;</span>
        <div class="modal-header">
          <h2>Portfolio Tracker</h2>
          <p class="muted">Track your investments and performance</p>
        </div>
        
        <div class="modal-body">
          <!-- User Identification Form -->
          <div class="user-identification" id="userIdentification">
            <h3>User Identification Required</h3>
            <p class="muted">Please enter your details to track your portfolio</p>
            
            <div class="form-group">
              <label for="userId">User ID:</label>
              <input type="text" id="userId" placeholder="Enter your unique ID" class="token-input" required>
              <small class="muted">This will be used to identify your portfolio</small>
            </div>
            
            <div class="form-group">
              <label for="userEmail">Email Address:</label>
              <input type="email" id="userEmail" placeholder="Enter your email" class="token-input" required>
              <small class="muted">We'll send you portfolio updates (optional)</small>
            </div>
            
            <button id="saveUserInfoBtn" class="add-token-btn">Save & Continue</button>
          </div>

          <!-- Portfolio Content (Hidden until user identifies) -->
          <div class="portfolio-content" id="portfolioContent" style="display: none;">
            <!-- User Info Display -->
            <div class="user-info-display" id="userInfoDisplay">
              <div class="user-badge">
                <strong>User:</strong> <span id="displayUserId">-</span> | 
                <strong>Email:</strong> <span id="displayUserEmail">-</span>
                <button id="editUserInfoBtn" class="edit-user-btn">Edit</button>
              </div>
            </div>

            <!-- Add Token Form -->
            <div class="add-token-form">
              <h3>Add Token to Portfolio</h3>
              <div class="form-group">
                <label for="tokenSelect">Select Token:</label>
                <select id="tokenSelect" class="token-select">
                  <option value="">Choose a token...</option>
                  <!-- Tokens will be populated dynamically -->
                </select>
              </div>
              
              <div class="form-group">
                <label for="tokenAmount">Amount of Tokens:</label>
                <input type="number" id="tokenAmount" min="0" step="0.000001" placeholder="Enter amount" class="token-input">
              </div>
              
              <div class="form-group">
                <label for="buyPrice">Buy Price (Optional):</label>
                <input type="number" id="buyPrice" min="0" step="0.000001" placeholder="Enter buy price in USD" class="token-input">
                <small class="muted">If not provided, current price will be used</small>
              </div>
              
              <button id="addTokenBtn" class="add-token-btn">Add to Portfolio</button>
            </div>

            <!-- Portfolio Summary -->
            <div class="portfolio-summary" id="portfolioSummary" style="display: none;">
              <h3>Portfolio Summary</h3>
              <div class="summary-cards">
                <div class="summary-card">
                  <strong>Total Value</strong>
                  <span id="totalValue" class="summary-value">$0.00</span>
                </div>
                <div class="summary-card">
                  <strong>Total Profit/Loss</strong>
                  <span id="totalProfitLoss" class="summary-value">$0.00</span>
                </div>
                <div class="summary-card">
                  <strong>Total ROI</strong>
                  <span id="totalROI" class="summary-value">0.00%</span>
                </div>
              </div>
            </div>

            <!-- Portfolio Table -->
            <div class="portfolio-table-container" id="portfolioTableContainer" style="display: none;">
              <h3>Your Holdings</h3>
              <div class="table-scroll-wrapper">
                <table class="portfolio-table">
                  <thead>
                    <tr>
                      <th>Token</th>
                      <th>Amount</th>
                      <th>Avg Buy Price</th>
                      <th>Current Price</th>
                      <th>Current Value</th>
                      <th>Profit/Loss</th>
                      <th>ROI</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="portfolioTableBody">
                    <!-- Portfolio items will be populated here -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Empty Portfolio State -->
            <div class="empty-portfolio" id="emptyPortfolio">
              <div class="empty-state">
                <h3>No tokens in portfolio yet</h3>
                <p>Add your first token to start tracking your investments</p>
              </div>
            </div>
          </div>
        </div>
        
        <div class="modal-footer" id="portfolioFooter" style="display: none;">
          <button id="clearPortfolioBtn" class="clear-portfolio-btn">Clear Portfolio</button>
          <button id="exportPortfolioBtn" class="export-portfolio-btn">Export Data</button>
        </div>
      </div>
    </div>

    <!-- Popular Memecoins -->
    <div class="section">
      <h2>Popular Memecoins</h2>
      <div class="table-scroll-wrapper">
        <table>
          <thead>
            <tr>
              <th data-sort="name">Name</th>
              <th data-sort="symbol">Symbol</th>
              <th data-sort="price">Price</th>
              <th data-sort="volume">Volume (24h)</th>
              <th data-sort="change">Change (24h)</th>
              <th data-sort="liquidity">Liquidity</th>
              <th data-sort="marketCap">Market Cap</th>
            </tr>
          </thead>
          <tbody id="popular-tokens">
            <tr><td colspan="7" class="loading">Loading popular tokens...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- New Listings -->
    <div class="section">
      <h2>New Listings</h2>

      <div class="controls">
        <input type="text" id="searchInput" placeholder="Search token..." />
        <select id="sortSelect">
          <option value="">Sort by</option>
          <option value="price">Price</option>
          <option value="volume">Volume</option>
          <option value="change">24h Change</option>
          <option value="liquidity">Liquidity</option>
          <option value="marketCap">Market Cap</option>
        </select>
        <select id="filterSelect">
          <option value="">All tokens</option>
          <option value="gainers">Gainers only</option>
          <option value="losers">Losers only</option>
        </select>
      </div>

      <div class="table-scroll-wrapper">
        <table>
          <thead>
            <tr>
              <th data-sort="name">Name</th>
              <th data-sort="symbol">Symbol</th>
              <th data-sort="price">Price</th>
              <th data-sort="volume">Volume (24h)</th>
              <th data-sort="change">Change (24h)</th>
              <th data-sort="liquidity">Liquidity</th>
              <th data-sort="marketCap">Market Cap</th>
            </tr>
          </thead>
          <tbody id="new-tokens">
            <tr><td colspan="7" class="loading">Loading new tokens...</td></tr>
          </tbody>
        </table>
      </div>

      <p class="muted">Click a token to open chart and details in a new tab</p>
    </div>

    <!-- Highly Risky Tokens -->
    <div class="section">
      <div class="high-risk-header">
        <h2>Highly Risky</h2>
        <p class="subheading">But Big Bangers</p>
      </div>
      
      <div class="controls">
        <input type="text" id="highriskSearchInput" placeholder="Search high risk token..." />
        <select id="highriskSortSelect">
          <option value="">Sort by</option>
          <option value="price">Price</option>
          <option value="volume">Volume</option>
          <option value="change">24h Change</option>
          <option value="liquidity">Liquidity</li>
          <option value="marketCap">Market Cap</option>
        </select>
        <select id="highriskFilterSelect">
          <option value="">All tokens</option>
          <option value="gainers">Gainers only</option>
          <option value="losers">Losers only</option>
        </select>
      </div>

      <div class="table-scroll-wrapper">
        <table>
          <thead>
            <tr>
              <th data-sort="name">Name</th>
              <th data-sort="symbol">Symbol</th>
              <th data-sort="price">Price</th>
              <th data-sort="volume">Volume (24h)</th>
              <th data-sort="change">Change (24h)</th>
              <th data-sort="liquidity">Liquidity</th>
              <th data-sort="marketCap">Market Cap</th>
            </tr>
          </thead>
          <tbody id="highrisk-tokens">
            <tr><td colspan="7" class="loading">Loading high risk tokens...</td></tr>
          </tbody>
        </table>
      </div>

      <p class="muted warning-text">
        <strong>Warning:</strong> These tokens are highly speculative and risky. Only invest what you can afford to lose.
      </p>
    </div>

    <div class="footer">
      <p>TikStake Memeboard &copy; 2025 • Information provided here should not be taken as a financial advice, please do your own research </p>
    </div>
  </div>

  <script src="script.js"></script>
  
  <!-- Real Firebase Counter with Proper Analytics -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, increment, onSnapshot, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBCONg4JM9jtThFa6ClRJQO15qPIX7QGUw",
      authDomain: "tikstakememes.firebaseapp.com",
      projectId: "tikstakememes",
      storageBucket: "tikstakememes.appspot.com",
      messagingSenderId: "462788871293",
      appId: "1:462788871293:web:7ccd28b554760c04a09d14",
      measurementId: "G-KT99VHJ4LT"
    };

    try {
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const today = new Date().toISOString().slice(0, 10);
      const dailyRef = doc(db, "analytics", "daily");
      const todayVisitorRef = doc(db, "dailyCounts", today);

      console.log("Firebase analytics started for:", today);

      // Track visitor and update all counters
      async function trackVisitor() {
        try {
          const timestamp = new Date().toISOString();
          
          // 1. Add to visitor log
          await addDoc(collection(db, "visitorLog"), {
            timestamp: timestamp,
            date: today,
            userAgent: navigator.userAgent
          });

          // 2. Update daily counter
          const dailySnap = await getDoc(todayVisitorRef);
          if (dailySnap.exists()) {
            await updateDoc(todayVisitorRef, {
              realCount: increment(1),
              lastUpdated: timestamp
            });
          } else {
            await setDoc(todayVisitorRef, {
              realCount: 1,
              date: today,
              created: timestamp
            });
          }

          // 3. Update overall analytics
          const analyticsSnap = await getDoc(dailyRef);
          if (analyticsSnap.exists()) {
            await updateDoc(dailyRef, {
              totalVisitors: increment(1),
              lastUpdated: timestamp
            });
          } else {
            await setDoc(dailyRef, {
              totalVisitors: 1,
              created: timestamp
            });
          }

          console.log("Visitor tracked successfully");

        } catch (error) {
          console.error("Tracking error:", error);
        }
      }

      // Real-time listener for today's count
      onSnapshot(todayVisitorRef, (snap) => {
        if (snap.exists()) {
          const data = snap.data();
          const realCount = data.realCount || 0;
          const displayCount = 50 + realCount; // Fake 50 + real count
          document.getElementById("statusText").textContent = `Connected (Visitors today: ${displayCount})`;
        } else {
          document.getElementById("statusText").textContent = "Connected (Visitors today: 50)";
        }
      });

      // Track this visitor
      trackVisitor();

    } catch (error) {
      console.error("Firebase failed:", error);
      document.getElementById("statusText").textContent = "Connected";
    }
  </script>
</body>
</html>